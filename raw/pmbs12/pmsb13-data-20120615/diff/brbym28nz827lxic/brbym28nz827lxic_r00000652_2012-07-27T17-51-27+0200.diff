diff -u -r -N -x '*.o' -x Thumbs.db -x .DS_Store -x CMakeCache.txt -x misc/seqan_instrumentation/userdata/id.txt -x C:/Users/David/Desktop/Seqan/Seqan/misc/seqan_instrumentation/userdata/id.txt -x misc/seqan_instrumentation/userdata/brbym28nz827lxic_stats.txt -x C:/Users/David/Desktop/Seqan/Seqan/misc/seqan_instrumentation/userdata/brbym28nz827lxic_stats.txt -x .svn -x bin -x build -x util -x misc -x docs -x docs2 -x extras -x core -x misc/seqan_instrumentation/bin -x C:/Users/David/Desktop/Seqan/Seqan/misc/seqan_instrumentation/bin -x misc/seqan_instrumentation/last_revision_copy -x C:/Users/David/Desktop/Seqan/Seqan/misc/seqan_instrumentation/last_revision_copy -x misc/seqan_instrumentation/last_revision_copy -x C:/Users/David/Desktop/Seqan/Seqan/misc/seqan_instrumentation/last_revision_copy -x misc/seqan_instrumentation/userdata -x C:/Users/David/Desktop/Seqan/Seqan/misc/seqan_instrumentation/userdata -x misc/seqan_instrumentation/userdata -x C:/Users/David/Desktop/Seqan/Seqan/misc/seqan_instrumentation/userdata ./misc/seqan_instrumentation/last_revision_copy/sandbox/meyerclp/apps/dreme/dreme.h ./sandbox/meyerclp/apps/dreme/dreme.h
--- ./misc/seqan_instrumentation/last_revision_copy/sandbox/meyerclp/apps/dreme/dreme.h	2012-07-27 17:15:54.886986000 +0200
+++ ./sandbox/meyerclp/apps/dreme/dreme.h	2012-07-27 17:51:22.703986000 +0200
@@ -135,7 +135,7 @@
 void ComparePWM(Seq &seq,std::map<unsigned int,std::map<Iupac,double> > &freqMatrix1,std::map<unsigned int,std::map<Iupac,double> > &freqMatrix2, Euklidisch const & tag);
 void PWMClustering(Seq &seq);
 void UpdateDistantMatrix(int n, int x, int y, std::vector<std::vector<double> > &compare, CompleteLinkage const & tag);
-void UpdateDistantMatrix(int n, int x, int y, std::vector<std::vector<double> > &compare, AverageLinkage const & tag);
+void UpdateDistantMatrix(int n, int x, int y, std::vector<std::vector<double> > &compare,std::vector<unsigned> &weights, AverageLinkage const & tag);
 void minDifferenceInMatrix(unsigned n,String<double> &minDifference,std::vector<std::vector<double> > compare);
 void replaceKmer(Seq &seq,unsigned int stringNumber, unsigned int begin, unsigned int end);
 void saveData(Seq &seq,std::ofstream &PWM);
@@ -836,10 +836,10 @@
 void BuildMeanOf2PWMs(Seq &seq,std::map<unsigned int,std::map<Iupac,double> > &freqMatrix1,std::map<unsigned int,std::map<Iupac,double> > &freqMatrix2){
 
 	for(unsigned int j=0;j<length(freqMatrix1);++j){
-		freqMatrix1[j]['A'] = (freqMatrix1[j]['A']+freqMatrix2[j]['A']);
-		freqMatrix1[j]['C'] = (freqMatrix1[j]['C']+freqMatrix2[j]['C']);
-		freqMatrix1[j]['G'] = (freqMatrix1[j]['G']+freqMatrix2[j]['G']);
-		freqMatrix1[j]['T'] = (freqMatrix1[j]['T']+freqMatrix2[j]['T']);
+		freqMatrix1[j]['A'] = (freqMatrix1[j]['A']+freqMatrix2[j]['A'])/2;
+		freqMatrix1[j]['C'] = (freqMatrix1[j]['C']+freqMatrix2[j]['C'])/2;
+		freqMatrix1[j]['G'] = (freqMatrix1[j]['G']+freqMatrix2[j]['G'])/2;
+		freqMatrix1[j]['T'] = (freqMatrix1[j]['T']+freqMatrix2[j]['T'])/2;
 	}
 	
 
@@ -867,10 +867,31 @@
 
 }
 
-void UpdateDistantMatrix(int n, int x, int y, std::vector<std::vector<double> > &compare, AverageLinkage const & tag ){
 
 
 
+void UpdateDistantMatrix(int n, int x, int y, std::vector<std::vector<double> > &compare,std::vector<unsigned> &weights, AverageLinkage const & tag ){
+
+
+	/***
+			Die alten Einträge gewichtet addieren --> Gewichte am Anfang =1 ^= Clustergröße
+			Zur Normierung durch die addierten Gewichte teilen
+	***/
+	unsigned j;
+	unsigned sumOfweights = weights[x] + weights[y];
+	
+	for (j = 0; j < x; j++)
+		compare[x][j] = (compare[y][j]*weights[y]+compare[x][j]*weights[x])/sumOfweights;
+	for (j = x+1; j < y; j++)
+		compare[j][x] = (compare[y][j]*weights[y]+compare[j][x]*weights[x])/sumOfweights;
+	for (j = y+1; j < n; j++)
+		compare[j][x] = (compare[j][y]*weights[y]+compare[j][x]*weights[x])/sumOfweights;
+	for (j = 0; j < y; j++) compare[y][j] = compare[n-1][j];
+	for (j = y+1; j < n-1; j++) compare[j][y] = compare[n-1][j];
+
+	weights[x]=sumOfweights;
+	weights[y];
+
 }
 
 
@@ -926,8 +947,15 @@
 	std::vector<int> clusterId(allPWMsLength);
 	unsigned j;
 	for (j = 0; j < allPWMsLength; j++) clusterId[j] = j;//to assign which PWM is in which cluster
+	/***
+			Average Linkage:
+	***/
+	std::vector<unsigned> weights(allPWMsLength,1);
 	
-	
+
+
+
+
 	computesDistantMatrix(seq,compare,allPWMsLength);
 
 	
